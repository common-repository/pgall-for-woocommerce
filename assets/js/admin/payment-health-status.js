jQuery(document).ready(function($){"use strict";var success_rate_chart=AmCharts.makeChart("chartdiv1",{type:"serial",theme:"light",autoMargins:!0,startDuration:1,dataProvider:[{category:"",excelent:5,good:10,average:15,poor:20,bad:50,limit:90,full:100}],valueAxes:[{maximum:100,stackType:"regular",gridAlpha:0}],graphs:[{fillAlphas:.8,lineColor:"#fb7116",showBalloon:!1,type:"column",valueField:"bad"},{fillAlphas:.8,lineColor:"#f6d32b",showBalloon:!1,type:"column",valueField:"poor"},{fillAlphas:.8,lineColor:"#f4fb16",showBalloon:!1,type:"column",valueField:"average"},{fillAlphas:.8,lineColor:"#b4dd1e",showBalloon:!1,type:"column",valueField:"good"},{fillAlphas:.8,lineColor:"#19d228",showBalloon:!1,type:"column",valueField:"excelent"},{clustered:!1,columnWidth:.3,fillAlphas:1,lineColor:"#000000",stackable:!1,type:"column",valueField:"bullet"}],rotate:!0,columnWidth:1,categoryField:"category",labelsEnabled:!1}),negative_gauge_chart=AmCharts.makeChart("negative_rate_gauge",{theme:"light",type:"gauge",axes:[{topTextFontSize:20,topTextYOffset:70,axisColor:"#31d6ea",axisThickness:1,endValue:100,gridInside:!0,inside:!0,radius:"50%",valueInterval:25,tickColor:"#67b7dc",startAngle:-90,endAngle:90,unit:"%",bandOutlineAlpha:0,bands:[{color:"#0080ff",endValue:100,innerRadius:"105%",radius:"170%",gradientRatio:[.5,0,-.5],startValue:0},{color:"#d3464d",endValue:0,innerRadius:"105%",radius:"170%",gradientRatio:[.5,0,-.5],startValue:0}]}],arrows:[{alpha:0,innerRadius:"5%",nailRadius:"5%",radius:"100%"}]}),positive_gauge_chart=AmCharts.makeChart("positive_rate_gauge",{theme:"light",type:"gauge",axes:[{topTextFontSize:20,topTextYOffset:70,axisColor:"#31d6ea",axisThickness:1,endValue:100,gridInside:!0,inside:!0,radius:"50%",valueInterval:25,tickColor:"#67b7dc",startAngle:-90,endAngle:90,unit:"%",bandOutlineAlpha:0,bands:[{color:"#0080ff",endValue:100,innerRadius:"105%",radius:"170%",gradientRatio:[.5,0,-.5],startValue:0},{color:"#3cd3a3",endValue:0,innerRadius:"105%",radius:"170%",gradientRatio:[.5,0,-.5],startValue:0}]}],arrows:[{alpha:1,innerRadius:"35%",nailRadius:0,radius:"170%"}]}),date_from="",date_to="",is_blocked=function(a){return a.is(".processing")||a.parents(".processing").length},block=function(a){is_blocked(a)||a.addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock=function(a){a.removeClass("processing").unblock()},top_sales_by_date_chart=(AmCharts.addInitHandler(function(a){void 0!==a.applyGapValue&&void 0!==a.categoryAxis&&!0===a.categoryAxis.parseDates&&AmCharts.applyGapValue.processData(a,!1)},["serial"]),AmCharts.applyGapValue={getDate:function(a,e){return"string"==typeof a&&void 0!==e?AmCharts.stringToDate(a,e):new Date(a)},formatDate:function(a,e,t){return"string"==typeof e&&void 0!==t?AmCharts.formatDate(a,t):"number"==typeof e?a.getTime():a},getPeriod:function(a){a=a||"DD";a=AmCharts.extractPeriod(a);return AmCharts.getPeriodDuration(a.period,a.count)},addPeriod:function(a,e,t){e=e||"DD";var e=AmCharts.extractPeriod(e),r=new Date(a);switch(e.period){case"YYYY":r.setFullYear(r.getFullYear()+t);break;case"MM":r.setFullYear(r.getFullYear(),r.getMonth()+t);break;case"DD":r.setFullYear(r.getFullYear(),r.getMonth(),r.getDate()+t);break;case"hh":r.setHours(r.getHours()+t);break;case"mm":r.setHours(r.getHours(),r.getMinutes()+t);break;case"ss":r.setHours(r.getHours(),r.getMinutes(),r.getSeconds()+t);break;case"fff":r.setTime(r.getTime()+t)}return r},processData:function(a,e){var t=0,r=a.dataProvider,l=a.categoryField,o=a.dataDateFormat;if(AmCharts.ifArray(r)&&0!==r.length){AmCharts.applyGapValue.getDate(r[0][l],o),AmCharts.applyGapValue.getDate(r[r.length-1][l],o);for(var s=r[0][l],n=[],i=0;i<r.length;i++)if(!0===a.accumulateValue&&(t+=parseFloat(r[i].value),r[i].acc_value=t),n.push(r[i]),i+1<r.length)for(var d=r[i+1],p=AmCharts.applyGapValue.getDate(d[l]),u=AmCharts.applyGapValue.addPeriod(AmCharts.applyGapValue.getDate(r[i][l]),a.categoryAxis.minPeriod,a.pafwGapValue);u<p;){var c={};c[l]=AmCharts.applyGapValue.formatDate(u,s,a.dataDateFormat);for(var h=0;h<a.graphs.length;h++)!0===a.accumulateValue?(c[a.graphs[h].valueField]=a.applyGapValue,c.acc_value=t):c[a.graphs[h].valueField]=a.applyGapValue;n.push(c),u=AmCharts.applyGapValue.addPeriod(u,a.categoryAxis.minPeriod,a.pafwGapValue)}a.dataProvider=n,e&&a.validateData()}}},AmCharts.makeChart("top_sales_by_date_chart",{type:"serial",theme:"light",applyGapValue:0,pafwGapValue:1,accumulateValue:!0,legend:{useGraphSettings:!0,markerSize:10,valueText:"",valueWidth:0},addClassNames:!0,startDuration:0,mouseWheelZoomEnabled:!1,dataDateFormat:"YYYY-MM-DD",valueAxes:[{stackType:"regular",gridAlpha:.07,position:"left",title:"건수"}],balloon:{borderThickness:1,shadowAlpha:0},graphs:[{balloonText:"<span style='font-size:10px;'>[[title]] <span style='font-size:12px; font-weight: bold;'>[[value]]건</span></span>",lineColor:"#cc4748",fillColors:"#cc4748",fillAlphas:.7,lineAlpha:.4,title:"결제실패",valueField:"negative"},{balloonText:"<span style='font-size:10px;'>[[title]] <span style='font-size:12px; font-weight: bold;'>[[value]]건</span></span>",fillAlphas:.4,lineAlpha:.4,title:"결제취소",valueField:"positive"},{balloonText:"<span style='font-size:10px;'>[[title]] <span style='font-size:12px; font-weight: bold;'>[[value]]건</span></span>",fillAlphas:.4,lineAlpha:.4,title:"결제시도",valueField:"request"},{balloonText:"<span style='font-size:10px;'>[[title]] <span style='font-size:12px; font-weight: bold;'>[[value]]건</span></span>",fillColors:"#5C9BD1",fillAlphas:.7,lineColor:"#5C9BD1",lineAlpha:.4,title:"결제성공",valueField:"success"}],chartScrollbar:{graph:"amount",oppositeAxis:!1,offset:10,scrollbarHeight:40,dragIconHeight:20,backgroundAlpha:0,selectedBackgroundAlpha:.1,selectedBackgroundColor:"#888888",graphFillAlpha:0,graphLineAlpha:.5,selectedGraphFillAlpha:0,selectedGraphLineAlpha:1,autoGridCount:!1,color:"#AAAAAA"},chartCursor:{pan:!0,valueLineEnabled:!0,valueLineBalloonEnabled:!0,cursorAlpha:1,cursorColor:"#258cbb",limitToGraph:"amount",valueLineAlpha:.2,valueZoomable:!0},categoryField:"pafw_date",categoryAxis:{equalSpacing:!0,parseDates:!0,dashLength:1,minorGridEnabled:!0},export:{enabled:!0},dataProvider:[]})),failed_count_by_payment_method=AmCharts.makeChart("failed_count_by_payment_method",{type:"pie",theme:"light",valueField:"count",titleField:"payment_method_title",colorField:"color",alpha:.9,balloon:{fixedPosition:!0},marginTop:15,marginBottom:15,marginLeft:0,marginRight:0,pullOutRadius:0,export:{enabled:!0},dataProvider:[]}),failed_count_by_result_code=AmCharts.makeChart("failed_count_by_result_code",{type:"pie",theme:"light",valueField:"count",titleField:"message",colorField:"color",alpha:.9,balloon:{fixedPosition:!0},marginTop:15,marginBottom:15,marginLeft:0,marginRight:0,pullOutRadius:0,export:{enabled:!0},dataProvider:[]}),sales_by_hour_chart=AmCharts.makeChart("sales_by_hour_chart",{type:"serial",theme:"light",graphs:[{id:"g1",type:"column",fillAlphas:.8,lineAlpha:.2,title:"red line",useLineColorForBulletBorder:!0,valueField:"value",balloonText:"<span style='font-size:18px;'>[[value]]</span>",valueAxis:"distanceAxis"}],chartCursor:{pan:!0,valueLineEnabled:!0,valueLineBalloonEnabled:!0,cursorAlpha:1,cursorColor:"#258cbb",valueLineAlpha:.2},categoryField:"hour",categoryAxis:{dashLength:1,equalSpacing:!0,minorGridEnabled:!0},dataProvider:[]});function zoomChart(){var a=top_sales_by_date_chart.dataProvider.length;30<a&&top_sales_by_date_chart.zoomToIndexes(a-30,a-1)}function get_dashboard_data(from,to){block($("#pafw-dashboard-wrapper")),$.ajax({type:"post",dataType:"json",url:ajaxurl,data:{action:_pafw_payment_health_status.dashboard_action,command:"get_dashboard_data",date_from:from,date_to:to,interval:$(".search-interval.selected").data("interval")},success:function(response){response.success?($.each(response.data,function(key,value){var fn="process_"+key;eval("typeof "+fn+" == 'function'")&&eval(fn)(value)}),zoomChart()):alert(response.data.message),unblock($("#pafw-dashboard-wrapper"))},error:function(){unblock($("#pafw-dashboard-wrapper"))}})}function process_order_stat_by_date(a){top_sales_by_date_chart.dataProvider=a,AmCharts.applyGapValue.processData(top_sales_by_date_chart,!0)}function process_failed_count_by_payment_method(a){failed_count_by_payment_method.dataProvider=a,failed_count_by_payment_method.validateData()}function process_failed_count_by_result_code(a){failed_count_by_result_code.dataProvider=a,failed_count_by_result_code.validateData()}function process_count_by_result_code(a){positive_gauge_chart.arrows[0].setValue(a.positive_ratio),positive_gauge_chart.axes[0].setTopText(a.positive_ratio+" %"),positive_gauge_chart.axes[0].bands[1].setEndValue(a.positive_ratio),negative_gauge_chart.arrows[0].setValue(a.negative_ratio),negative_gauge_chart.axes[0].setTopText(a.negative_ratio+" %"),negative_gauge_chart.axes[0].bands[1].setEndValue(a.negative_ratio),success_rate_chart.dataProvider=[{category:"",excelent:5,good:10,average:15,poor:20,bad:50,limit:90,full:100,bullet:a.positive_ratio}],success_rate_chart.validateData(),success_rate_chart.animateAgain()}function process_payment_statistics(a){$("div.pafw-dashboard-stat .completed span.amount").html(a.completed.amount),$("div.pafw-dashboard-stat .completed span.count").html(a.completed.count),$("div.pafw-dashboard-stat .request span.amount").html(a.request.amount),$("div.pafw-dashboard-stat .request span.count").html(a.request.count),$("div.pafw-dashboard-stat .cancelled span.amount").html(a.cancelled.amount),$("div.pafw-dashboard-stat .cancelled span.count").html(a.cancelled.count),$("div.pafw-dashboard-stat .failed span.amount").html(a.failed.amount),$("div.pafw-dashboard-stat .failed span.count").html(a.failed.count)}function process_order_stat_by_hour(a){for(var t=[],e=0;e<24;e++)t.push({hour:e,value:"0"});$.each(a,function(a,e){t[parseInt(e.hour)].value=e.value}),sales_by_hour_chart.dataProvider=t,sales_by_hour_chart.validateData()}function process_order_stat_by_order_status(a){$(".pafw-dashboard-stat .order-status .count").html("0"),$(".pafw-dashboard-stat .order-status .amount").html("0"),$.each(a,function(a,e){$(".pafw-dashboard-stat ."+e.order_status+" .count").html(e.count),$(".pafw-dashboard-stat ."+e.order_status+" .amount").html(e.amount)}),sales_by_hour_chart.validateData()}function process_sales_stat_by_product(a){$("table.sales_by_product tbody").empty(),$.each(a.order_by_amount,function(a,e){var t="amount_spartline_"+e.id,r=(e.id,'<div id="'+t+'" style="vertical-align: middle;display: inline-block; width: 110px; height: 30px;"></div></div>'),r=($("table.sales_by_product.amount tbody").append('<tr><td class="title">'+e.name+'</td><td class="value">'+e.value+'</td><td class="spartline">'+r+"</td></tr>"),JSON.parse(JSON.stringify(spartLineParams)));r.dataProvider=e.trends,AmCharts.makeChart(t,r)}),$.each(a.order_by_qty,function(a,e){var t="qty_spartline_"+e.id,r='<div id="'+t+'" style="vertical-align: middle;display: inline-block; width: 110px; height: 30px;">',r=($("table.sales_by_product.qty tbody").append('<tr><td class="title">'+e.name+'</td><td class="value">'+e.value+'</td><td class="spartline">'+r+"</td></tr></tr>"),JSON.parse(JSON.stringify(spartLineParams2)));r.dataProvider=e.trends,AmCharts.makeChart(t,r),AmCharts.makeChart(t,r)})}$("#reportrange").daterangepicker({locale:{format:"YYYY-MM-DD",separator:" - ",applyLabel:"적용",cancelLabel:"취소",fromLabel:"시작일자",toLabel:"끝일자",customRangeLabel:"범위선택",weekLabel:"W",daysOfWeek:["일","월","화","수","목","금","토"],monthNames:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],firstDay:1},alwaysShowCalendars:!0,opens:"right",startDate:_pafw_payment_health_status.start_date,endDate:_pafw_payment_health_status.end_date,maxDate:moment(),ranges:{"지난 30일":[moment().subtract(29,"days"),moment()],"지난 90일":[moment().subtract(89,"days"),moment()],"지난 180일":[moment().subtract(179,"days"),moment()],"이번달":[moment().startOf("month"),moment().endOf("month")],"지난달":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]}}),$("#reportrange").on("apply.daterangepicker",function(a,e){date_from=$("#reportrange").data("daterangepicker").startDate.format("YYYY-MM-DD"),date_to=$("#reportrange").data("daterangepicker").endDate.format("YYYY-MM-DD"),$("#reportrange span").html(date_from+" - "+date_to),get_dashboard_data(date_from,date_to)}.bind(this)),date_from=_pafw_payment_health_status.start_date,date_to=_pafw_payment_health_status.end_date,get_dashboard_data(_pafw_payment_health_status.start_date,_pafw_payment_health_status.end_date),$(".search-interval").on("click",function(){var a=$(this).data("interval"),e=$(this).data("gap_value");top_sales_by_date_chart.pafwGapValue=e,top_sales_by_date_chart.categoryAxis.minPeriod="1M"==a?"MM":"DD",$(".search-interval").removeClass("selected"),$(".search-interval[data-interval="+a+"]").addClass("selected"),$("#reportrange").trigger("apply.daterangepicker")})});